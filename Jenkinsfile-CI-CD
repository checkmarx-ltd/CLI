pipeline {
    agent any

    parameters {
        // Define a Boolean parameter for IsReleaseBuild
        booleanParam(name: 'IsReleaseBuild', defaultValue: false, description: 'Is this a release build?')
	string(name: 'Tag', defaultValue: '', description: 'Enter the Git Tag to use (e.g., v1.0.0)')

    }

    stages {
        stage('Pipeline Info') {
            steps {
                script {
                    env.PIPELINE_STATUS = "Success"
                    env.STAGE_NAME_FAILED = "None"
                }
            }
        }

        stage('Build and generate CLI artifact') {
            steps {
                echo 'Triggering the Plugin-CLI-ByTag2 pipeline...'
                build job: 'Plugin-CLI-ByTag2', wait: true, parameters: [
                      string(name: 'Tag', value: params.Tag),
		      booleanParam(name: 'IsReleaseBuild', value: params.IsReleaseBuild)
                  ]
            }
			post {
                failure {
                    script {
                        env.PIPELINE_STATUS = "Failure"
                        env.STAGE_NAME_FAILED="${STAGE_NAME}"
                    }
                }
            }
        }
        stage('Run CLI Automation Tests') {
            steps {
                echo 'Triggering the Plugin-CLI-CI-Tests pipeline...'
                build job: 'Plugin-CLI-CI-Tests', wait: true
            }
			post {
                        failure {
                            script {
                                env.PIPELINE_STATUS = "Failure"
                                env.STAGE_NAME_FAILED="${STAGE_NAME}"
                            }
                        }
                    }
        }
    }
}
